import { GetLgtmDataResult, InputData } from "@/types/lgtm-data";
import getFontData from "@/utils/google-font";
import { ImageResponseOptions } from "next/server";

async function getLgtmData(inputData: InputData): Promise<GetLgtmDataResult> {
  const designInfo = {
    author: "kazzyfrog",
    description:
      "淹れたてのアイスコーヒーです。一言メッセージを書いて差し入れできます:)",
    editableFields: ["text"],
  };

  const options: ImageResponseOptions = {
    width: 450,
    height: 683,
    emoji: "noto",
    fonts: [
      {
        name: "Caveat",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Caveat:wght@700",
        ),
        weight: 700,
      },
      {
        name: "Yusei Magic",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap",
        ),
        weight: 400,
      },
    ],
  };

  const element = (
    <div tw="flex h-full w-full flex-col items-center justify-center">
      <div tw="absolute flex">
        <svg
          width="449"
          height="683"
          viewBox="0 0 449 683"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#339B3E"
            d="M160 4.334 178.5 0l92.827 396.273-18.499 4.334z"
          />
          <path
            d="m1 223 11-47h425l11 47zm56 459L25 223h398.5l-31.831 459z"
            fill="#fff"
            fill-opacity=".3"
            stroke="#D9D9D9"
          />
          <path
            d="m416.564 294.924 1.099-1.429-.338 4.989-7.325-.181 2.37-.656 1.031-.432 1.032-.431 1.065-.93z"
            fill="#F6E7D1"
            stroke="#F6E7D1"
          />
          <path d="M30.747 298 57.5 681.5h334L417.838 298z" fill="#F6E7D1" />
          <path
            d="M135.744 594.972h3.492v22.68h13.212V621h-16.704zm42.278 23.796q-.54.468-1.512.936-.972.432-2.16.792-1.152.36-2.412.576a13.3 13.3 0 0 1-2.304.216q-3.132 0-5.652-.972-2.484-.972-4.284-2.7a12.2 12.2 0 0 1-2.736-4.068q-.936-2.34-.936-5.076 0-3.24 1.044-5.796 1.08-2.592 2.916-4.356a12.35 12.35 0 0 1 4.284-2.7 14 14 0 0 1 5.112-.936q2.268 0 4.212.54t3.42 1.368l-1.188 3.204q-.72-.432-1.8-.792a16 16 0 0 0-2.16-.576 9.5 9.5 0 0 0-2.088-.252q-2.304 0-4.176.72-1.872.684-3.204 2.016-1.332 1.296-2.052 3.168-.72 1.836-.72 4.14 0 2.124.72 3.888a8.9 8.9 0 0 0 2.052 3.06q1.332 1.26 3.168 1.98 1.872.684 4.104.684 1.332 0 2.628-.252 1.296-.288 2.232-.792v-5.184h-5.184v-3.348h8.676zm4.752-23.796h17.28v3.348h-6.984V621h-3.492v-22.68h-6.804zM205.599 621v-26.856h.036l13.644 19.368-1.476-.288 13.608-19.08h.072V621h-3.456v-18.936l.216 1.764-9.828 13.896h-.072l-9.972-13.896.612-1.62V621zm56.022-1.368q-1.008.792-2.412 1.26a8.8 8.8 0 0 1-2.808.468q-2.448 0-4.284-.972t-2.88-2.7q-1.008-1.764-1.008-4.14t1.08-4.14q1.116-1.764 2.88-2.7a8 8 0 0 1 3.852-.972q1.8 0 3.204.504 1.44.504 2.448 1.368l-1.656 2.16a7 7 0 0 0-1.584-.9q-.936-.396-2.124-.396-1.296 0-2.412.684a4.8 4.8 0 0 0-1.728 1.8q-.612 1.152-.612 2.592 0 1.368.648 2.556a4.9 4.9 0 0 0 1.8 1.836q1.152.648 2.628.648.972 0 1.764-.288a5.1 5.1 0 0 0 1.476-.792zm10.514 1.728q-2.088 0-3.816-.9-1.692-.9-2.7-2.628-.972-1.764-.972-4.284 0-2.484 1.044-4.284 1.044-1.836 2.772-2.808 1.764-.972 3.852-.972t3.528.972q1.44.936 2.196 2.232l-.216.576.324-3.168h3.096V621h-3.348v-3.888l.36.864q-.144.36-.648.936-.468.54-1.296 1.116a7.8 7.8 0 0 1-1.836.972q-1.044.36-2.34.36m.9-2.772q1.26 0 2.268-.468a4.44 4.44 0 0 0 1.656-1.296q.684-.864.936-2.052v-2.916a4.44 4.44 0 0 0-1.008-1.872 4.7 4.7 0 0 0-1.728-1.26q-1.008-.468-2.232-.468-1.332 0-2.448.648a5 5 0 0 0-1.8 1.8q-.648 1.152-.648 2.7 0 1.44.684 2.628a5.1 5.1 0 0 0 1.836 1.872 4.8 4.8 0 0 0 2.484.684M288.261 621v-11.916h-2.556v-2.988h2.556v-6.3q0-3.24 1.44-4.968 1.476-1.728 4.32-1.728.756 0 1.656.216a4.3 4.3 0 0 1 1.62.72l-1.404 2.412a1.6 1.6 0 0 0-.72-.432 2.3 2.3 0 0 0-.792-.144q-1.332 0-2.052.9t-.72 3.06v6.264h4.716v2.988h-4.716V621zm18.52.36q-2.556 0-4.392-1.008-1.836-1.044-2.844-2.808-.972-1.8-.972-4.104 0-2.196 1.116-3.996a8.4 8.4 0 0 1 2.988-2.88q1.872-1.08 4.176-1.08 2.952 0 4.896 1.728t2.628 4.752l-12.276 4.32-.792-1.98 10.08-3.672-.72.468a4.86 4.86 0 0 0-1.44-2.052q-1.008-.9-2.628-.9-1.368 0-2.448.684a4.53 4.53 0 0 0-1.692 1.8q-.612 1.152-.612 2.628 0 1.548.648 2.736a5 5 0 0 0 1.764 1.836q1.152.648 2.592.648.972 0 1.872-.36.936-.36 1.728-.936l1.548 2.484q-1.116.756-2.52 1.224a8.3 8.3 0 0 1-2.7.468"
            fill="#000"
          />
          <path stroke="#000" d="M109 643.5h230.187" />
        </svg>
      </div>
      <div tw="w-[344px] h-[260px] mt-46 flex overflow-hidden items-center text-center justify-center">
        <p
          tw="text-[64px]"
          style={{
            transform: "rotate(-6.5deg)",
            overflowWrap: "break-word",
          }}
        >
          {inputData.text}
        </p>
      </div>
    </div>
  );

  return {
    designInfo,
    element,
    options,
  };
}

export default getLgtmData;
