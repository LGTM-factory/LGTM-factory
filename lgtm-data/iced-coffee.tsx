import { GetLgtmDataResult, InputData } from "@/types/lgtm-data";
import getFontData from "@/utils/google-font";
import { ImageResponseOptions } from "next/server";

async function getLgtmData(inputData: InputData): Promise<GetLgtmDataResult> {
  const designInfo = {
    author: "kazzyfrog",
    description:
      "淹れたてのアイスコーヒーです。一言メッセージを書いて差し入れできます:)",
    editableFields: ["text"],
  };

  const options: ImageResponseOptions = {
    width: 450,
    height: 683,
    emoji: "noto",
    fonts: [
      {
        name: "Caveat",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Caveat:wght@700",
        ),
        weight: 700,
      },
      {
        name: "Yusei Magic",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap",
        ),
        weight: 400,
      },
    ],
  };

  const element = (
    <div tw="flex h-full w-full flex-col items-center justify-center">
      <div tw="absolute flex">
        <svg
          width="449"
          height="683"
          viewBox="0 0 449 683"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="#339B3E"
            d="M168 4.334 186.5 0l92.827 396.273-18.499 4.334z"
          />
          <path
            d="M57 682 25 223h398.5l-31.831 459z"
            fill="#fff"
            fill-opacity=".3"
            stroke="#D9D9D9"
          />
          <path d="M30.626 298 57 682l334-.5L417.91 298z" fill="#463112" />
          <path d="M115 352h218v246H115z" fill="#fff" fill-opacity=".98" />
          <path stroke="#fff" stroke-width="4" d="M101 335h243v280H101z" />
          <path
            d="M143.328 539.864h3.104v20.16h11.744V563h-14.848zm37.581 21.152q-.48.416-1.344.832a17 17 0 0 1-1.92.704 17 17 0 0 1-2.144.512q-1.088.192-2.048.192-2.784 0-5.024-.864-2.208-.864-3.808-2.4a10.8 10.8 0 0 1-2.432-3.616q-.832-2.08-.832-4.512 0-2.88.928-5.152.96-2.304 2.592-3.872a11 11 0 0 1 3.808-2.4 12.4 12.4 0 0 1 4.544-.832q2.016 0 3.744.48t3.04 1.216l-1.056 2.848q-.64-.384-1.6-.704a14 14 0 0 0-1.92-.512 8.5 8.5 0 0 0-1.856-.224q-2.049 0-3.712.64a7.7 7.7 0 0 0-2.848 1.792q-1.185 1.152-1.824 2.816-.64 1.632-.64 3.68 0 1.889.64 3.456a7.9 7.9 0 0 0 1.824 2.72q1.184 1.12 2.816 1.76 1.663.608 3.648.608 1.184 0 2.336-.224 1.152-.256 1.984-.704v-4.608h-4.608v-2.976h7.712zm4.223-21.152h15.36v2.976h-6.208V563h-3.104v-20.16h-6.048zM205.422 563v-23.872h.032l12.128 17.216-1.312-.256 12.096-16.96h.064V563h-3.072v-16.832l.192 1.568-8.736 12.352h-.064l-8.864-12.352.544-1.44V563zm49.797-1.216q-.896.704-2.144 1.12a7.9 7.9 0 0 1-2.496.416q-2.176 0-3.808-.864a6.46 6.46 0 0 1-2.56-2.4q-.896-1.568-.896-3.68t.96-3.68q.992-1.567 2.56-2.4a7.1 7.1 0 0 1 3.424-.864q1.6 0 2.848.448 1.28.448 2.176 1.216l-1.472 1.92a6.3 6.3 0 0 0-1.408-.8q-.832-.352-1.888-.352-1.152 0-2.144.608a4.26 4.26 0 0 0-1.536 1.6q-.544 1.024-.544 2.304 0 1.216.576 2.272a4.34 4.34 0 0 0 1.6 1.632q1.024.576 2.336.576.864 0 1.568-.256a4.6 4.6 0 0 0 1.312-.704zm9.346 1.536q-1.857 0-3.392-.8-1.505-.8-2.4-2.336-.864-1.568-.864-3.808 0-2.208.928-3.808.928-1.632 2.464-2.496a7 7 0 0 1 3.424-.864q1.855 0 3.136.864 1.28.832 1.952 1.984l-.192.512.288-2.816h2.752V563h-2.976v-3.456l.32.768q-.129.32-.576.832-.417.48-1.152.992a7 7 0 0 1-1.632.864q-.928.32-2.08.32m.8-2.464q1.119 0 2.016-.416a3.94 3.94 0 0 0 1.472-1.152q.607-.768.832-1.824v-2.592a3.95 3.95 0 0 0-.896-1.664 4.2 4.2 0 0 0-1.536-1.12 4.7 4.7 0 0 0-1.984-.416q-1.185 0-2.176.576a4.4 4.4 0 0 0-1.6 1.6q-.576 1.024-.576 2.4 0 1.28.608 2.336a4.5 4.5 0 0 0 1.632 1.664 4.25 4.25 0 0 0 2.208.608M278.899 563v-10.592h-2.272v-2.656h2.272v-5.6q0-2.88 1.28-4.416 1.311-1.536 3.84-1.536.671 0 1.472.192a3.9 3.9 0 0 1 1.44.64l-1.248 2.144a1.44 1.44 0 0 0-.64-.384 2 2 0 0 0-.704-.128q-1.185 0-1.824.8-.64.8-.64 2.72v5.568h4.192v2.656h-4.192V563zm16.462.32q-2.272 0-3.904-.896-1.632-.928-2.528-2.496-.864-1.6-.864-3.648 0-1.952.992-3.552a7.45 7.45 0 0 1 2.656-2.56q1.664-.96 3.712-.96 2.624 0 4.352 1.536t2.336 4.224l-10.912 3.84-.704-1.76 8.96-3.264-.64.416a4.3 4.3 0 0 0-1.28-1.824q-.896-.8-2.336-.8-1.216 0-2.176.608a4.03 4.03 0 0 0-1.504 1.6q-.544 1.024-.544 2.336 0 1.376.576 2.432a4.4 4.4 0 0 0 1.568 1.632q1.024.576 2.304.576.864 0 1.664-.32a6.7 6.7 0 0 0 1.536-.832l1.376 2.208a9 9 0 0 1-2.24 1.088 7.4 7.4 0 0 1-2.4.416"
            fill="#000"
          />
          <path stroke="#000" d="M123 582.5h203.01" />
          <path
            d="m1 223 11-47h425l11 47z"
            fill="#fff"
            fill-opacity=".3"
            stroke="#D9D9D9"
          />
          <path
            d="m31.949 294.595-1.08-1.444.27 4.993 5.491-.295-.526-.473-1.025-.445-1.026-.446-1.052-.945zm384.615 1.026 1.099-1.429-.338 4.988L410 299l2.37-.657 1.031-.431 1.032-.431 1.065-.93z"
            fill="#463112"
            stroke="#463112"
          />
        </svg>
      </div>
      <div tw="w-[218px] h-[180px] flex items-center px-1 justify-center">
        <p
          tw="text-[46px] mt-46"
          style={{
            transform: "rotate(-6.5deg)",
            wordBreak: "break-all",
          }}
        >
          {inputData.text}
        </p>
      </div>
    </div>
  );

  return {
    designInfo,
    element,
    options,
  };
}

export default getLgtmData;
