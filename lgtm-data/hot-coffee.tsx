import { GetLgtmDataResult, InputData } from "@/types/lgtm-data";
import getFontData from "@/utils/google-font";
import { ImageResponseOptions } from "next/server";

async function getLgtmData(inputData: InputData): Promise<GetLgtmDataResult> {
  const designInfo = {
    author: "kazzyfrog",
    description:
      "美味しいホットコーヒーです。一言メッセージを書いて差し入れできます:)",
    editableFields: ["text"],
  };

  const options: ImageResponseOptions = {
    width: 460,
    height: 600,
    emoji: "noto",
    fonts: [
      {
        name: "Caveat",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Caveat:wght@700",
        ),
        weight: 700,
      },
      {
        name: "Yusei Magic",
        data: await getFontData(
          "https://fonts.googleapis.com/css2?family=Yusei+Magic&display=swap",
        ),
        weight: 400,
      },
    ],
  };

  const element = (
    <div tw="flex h-full w-full flex-col items-center justify-center">
      <div tw="absolute flex">
        <svg
          width="452.007"
          height="564"
          viewBox="0 0 452.007 564"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M57.14 564 25.224 100.894H426.85l-31.911 463.105z"
            fill="#fff"
          />
          <path
            stroke="#000"
            d="M110.984 525.155H343.23"
            stroke-width="1.009"
          />
          <path
            d="M136.958 476.193h3.523v22.883h13.33v3.378h-16.853zm42.656 24.009q-.545.472-1.526.944-.981.436-2.179.799-1.162.363-2.434.581a13.4 13.4 0 0 1-2.325.218q-3.16 0-5.703-.981-2.506-.981-4.322-2.724a12.3 12.3 0 0 1-2.76-4.104q-.944-2.361-.944-5.121 0-3.269 1.053-5.848 1.09-2.615 2.942-4.395a12.5 12.5 0 0 1 4.322-2.724 14.1 14.1 0 0 1 5.158-.944q2.288 0 4.25.545t3.451 1.38l-1.199 3.233q-.726-.436-1.816-.799a16 16 0 0 0-2.179-.581 9.6 9.6 0 0 0-2.107-.254q-2.325 0-4.213.726-1.889.69-3.233 2.034-1.344 1.308-2.07 3.196-.726 1.852-.726 4.177 0 2.143.726 3.923a9 9 0 0 0 2.07 3.087q1.344 1.271 3.196 1.998 1.889.69 4.141.69 1.344 0 2.652-.254 1.308-.291 2.252-.799v-5.23h-5.23v-3.378h8.754zm4.795-24.009h17.435v3.378h-7.046v22.883h-3.523v-22.883h-6.865zm23.029 26.261v-27.096h.036l13.766 19.541-1.489-.291 13.73-19.251h.073v27.097h-3.487v-19.105l.218 1.78-9.916 14.02h-.073l-10.061-14.02.617-1.634v18.959zm56.523-1.38q-1.017.799-2.434 1.271a8.9 8.9 0 0 1-2.833.472q-2.47 0-4.322-.981t-2.906-2.724q-1.017-1.78-1.017-4.177t1.09-4.177q1.126-1.78 2.906-2.724a8.1 8.1 0 0 1 3.886-.981q1.816 0 3.233.509 1.453.509 2.47 1.38l-1.671 2.179a7 7 0 0 0-1.598-.908q-.944-.4-2.143-.4-1.308 0-2.434.69a4.84 4.84 0 0 0-1.743 1.816q-.617 1.162-.617 2.615 0 1.38.654 2.579a4.94 4.94 0 0 0 1.816 1.852q1.162.654 2.652.654.981 0 1.78-.291a5.2 5.2 0 0 0 1.489-.799zm10.608 1.743q-2.107 0-3.85-.908-1.707-.908-2.724-2.652-.981-1.78-.981-4.322 0-2.506 1.053-4.322 1.053-1.852 2.797-2.833 1.78-.981 3.886-.981t3.56.981q1.453.944 2.216 2.252l-.218.581.327-3.196h3.124v15.037h-3.378v-3.923l.363.872q-.145.363-.654.944-.472.545-1.308 1.126a8 8 0 0 1-1.852.981q-1.053.363-2.361.363m.908-2.797q1.271 0 2.288-.472a4.5 4.5 0 0 0 1.671-1.308q.69-.872.944-2.07v-2.942a4.5 4.5 0 0 0-1.017-1.889 4.74 4.74 0 0 0-1.743-1.271q-1.017-.472-2.252-.472-1.344 0-2.47.654a5.05 5.05 0 0 0-1.816 1.816q-.654 1.162-.654 2.724 0 1.453.69 2.652a5.15 5.15 0 0 0 1.852 1.889 4.84 4.84 0 0 0 2.506.69m15.363 2.433v-12.023h-2.579v-3.015h2.579v-6.356q0-3.269 1.453-5.012 1.489-1.743 4.359-1.743.763 0 1.671.218a4.3 4.3 0 0 1 1.634.726l-1.417 2.434a1.6 1.6 0 0 0-.726-.436 2.3 2.3 0 0 0-.799-.145q-1.344 0-2.07.908t-.726 3.087v6.32h4.758v3.015h-4.758v12.022zm18.686.363q-2.579 0-4.431-1.017-1.852-1.053-2.869-2.833-.981-1.816-.981-4.141 0-2.216 1.126-4.032a8.5 8.5 0 0 1 3.015-2.906q1.889-1.09 4.213-1.09 2.978 0 4.94 1.743t2.652 4.795l-12.386 4.359-.799-1.998 10.17-3.705-.726.472a4.9 4.9 0 0 0-1.453-2.07q-1.017-.908-2.652-.908-1.38 0-2.47.69a4.57 4.57 0 0 0-1.707 1.816q-.617 1.162-.617 2.652 0 1.562.654 2.76a5.05 5.05 0 0 0 1.78 1.852q1.162.654 2.615.654.981 0 1.889-.363.944-.363 1.743-.944l1.562 2.506q-1.126.763-2.543 1.235a8.4 8.4 0 0 1-2.724.472"
            fill="#000"
          />
          <path
            d="M421.739 189.682H30.268l11.623 212.887h367.168z"
            fill="#E2D1B8"
          />
          <path
            d="M38.34 47.42 47.42 0h355.521l9.213 47.42h39.212l.137 53.474H0V47.42z"
            fill="#6A5F4E"
          />
        </svg>
      </div>
      <div
        tw="w-[380px] flex items-center justify-center"
        style={{
          transform: "rotate(-6.5deg)",
        }}
      >
        <p
          tw="text-[64px] text-center"
          style={{
            overflowWrap: "break-word",
          }}
        >
          {inputData.text}
        </p>
      </div>
    </div>
  );

  return {
    designInfo,
    element,
    options,
  };
}

export default getLgtmData;
